import{_ as j,r as i,i as z,j as D,o as E,c as p,b as x,a as n,d as l,w as h,k as A,h as y,t as G,l as H,s as m,f as N,u as J,g as s,F as B,e as L,m as K}from"./index-_0YP8fyM.js";import{餐 as O,乳 as Q,美 as W,酒 as X,粮 as Y,冰 as Z,海 as ee,肉 as ae,新 as te,时 as oe}from"./时令水果-DDy7EzII.js";const ne={class:"category"},se={class:"category-container"},ce={class:"category-nav"},ie={class:"category-content"},le={key:0,class:"category-header"},re={class:"category-icon"},de=["src","alt"],_e={class:"category-name"},ue={class:"product-list"},ve={class:"product-img"},me=["src","alt"],ge={__name:"CategoryView",setup(fe){const w=H(),S=J(),o=i([]),r=i([]),u=i(0),v=i(!1),I=i(!1),k=i(1),V=i(10),q=()=>{const a=localStorage.getItem("userInfo");return a&&a!=="null"},d=z(()=>o.value.length===0?null:o.value[u.value]),F=()=>{o.value=[{id:1,name:"餐饮美食",icon:O},{id:2,name:"乳品烘焙",icon:Q},{id:3,name:"美妆百货",icon:W},{id:4,name:"酒水饮料",icon:X},{id:5,name:"粮油调味",icon:Y},{id:6,name:"冰品面点",icon:Z},{id:7,name:"海鲜水产",icon:ee},{id:8,name:"肉禽蛋品",icon:ae},{id:9,name:"新鲜蔬菜",icon:te},{id:10,name:"时令水果",icon:oe}];const a=Number(w.query.categoryId);if(a){const e=o.value.findIndex(c=>c.id===a);if(e!==-1){u.value=e,g(a);return}}o.value.length>0&&g(o.value[0].id)},g=async a=>{try{k.value=1,I.value=!1,r.value=[],await P(a)}catch(e){console.error("加载分类商品失败:",e),m("加载分类商品失败")}},P=async a=>{try{const e=await N.get("/products");if(e.data.code===200){const _=e.data.data.filter($=>$.category_id===a),f=(k.value-1)*V.value,C=f+V.value,b=_.slice(f,C);r.value=[...r.value,...b],r.value.length>=_.length&&(I.value=!0),k.value++}v.value=!1}catch(e){console.error("获取商品失败:",e),v.value=!1,m("获取商品失败")}},M=()=>{d.value?P(d.value.id):v.value=!1},R=async a=>{if(!q()){m("请先登录"),S.push("/profile");return}try{(await N.post("/cart/add",{productId:a.id,quantity:1})).data.code===200&&m("添加成功")}catch(e){console.error("添加购物车失败:",e),m("添加购物车失败")}};return D(()=>w.query.categoryId,a=>{if(a&&o.value.length>0){const e=Number(a),c=o.value.findIndex(_=>_.id===e);c!==-1&&(u.value=c,g(e))}}),E(()=>{F()}),(a,e)=>{const c=l("van-nav-bar"),_=l("van-sidebar-item"),f=l("van-sidebar"),C=l("van-empty"),b=l("van-icon"),$=l("van-cell"),T=l("van-list");return s(),p("div",ne,[x(c,{title:"分类",fixed:"",placeholder:""}),n("div",se,[n("div",ce,[x(f,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t)},{default:h(()=>[(s(!0),p(B,null,L(o.value,t=>(s(),y(_,{key:t.id,title:t.name,onClick:U=>g(t.id)},null,8,["title","onClick"]))),128))]),_:1},8,["modelValue"])]),n("div",ie,[d.value?(s(),p("div",le,[n("div",re,[n("img",{src:d.value.icon,alt:d.value.name},null,8,de)]),n("div",_e,G(d.value.name),1)])):A("",!0),r.value.length===0?(s(),y(C,{key:1,description:"暂无商品"})):(s(),y(T,{key:2,loading:v.value,"onUpdate:loading":e[1]||(e[1]=t=>v.value=t),finished:I.value,"finished-text":"没有更多了",onLoad:M},{default:h(()=>[n("div",ue,[(s(!0),p(B,null,L(r.value,t=>(s(),y($,{key:t.id,title:t.title,label:`¥${t.price}`,center:""},{icon:h(()=>[n("div",ve,[n("img",{src:t.image,alt:t.title},null,8,me)])]),"right-icon":h(()=>[x(b,{name:"cart-o",class:"cart-icon",onClick:K(U=>R(t),["stop"])},null,8,["onClick"])]),_:2},1032,["title","label"]))),128))])]),_:1},8,["loading","finished"]))])])])}}},ye=j(ge,[["__scopeId","data-v-32b17061"]]);export{ye as default};
