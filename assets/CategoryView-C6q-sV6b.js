import{_ as U,r as i,i as j,j as z,o as D,c as f,b as x,a as o,d as l,w as p,k as E,h as y,t as R,l as A,s as h,f as N,g as s,F as B,e as q,m as G}from"./index-CQ_8GmyQ.js";import{餐 as H,乳 as J,美 as K,酒 as O,粮 as Q,冰 as W,海 as X,肉 as Y,新 as Z,时 as ee}from"./时令水果-DDy7EzII.js";const ae={class:"category"},te={class:"category-container"},ne={class:"category-nav"},oe={class:"category-content"},se={key:0,class:"category-header"},ce={class:"category-icon"},ie=["src","alt"],le={class:"category-name"},re={class:"product-list"},de={class:"product-img"},_e=["src","alt"],ue={__name:"CategoryView",setup(ve){const w=A(),n=i([]),r=i([]),u=i(0),v=i(!1),I=i(!1),C=i(1),V=i(10),d=j(()=>n.value.length===0?null:n.value[u.value]),L=()=>{n.value=[{id:1,name:"餐饮美食",icon:H},{id:2,name:"乳品烘焙",icon:J},{id:3,name:"美妆百货",icon:K},{id:4,name:"酒水饮料",icon:O},{id:5,name:"粮油调味",icon:Q},{id:6,name:"冰品面点",icon:W},{id:7,name:"海鲜水产",icon:X},{id:8,name:"肉禽蛋品",icon:Y},{id:9,name:"新鲜蔬菜",icon:Z},{id:10,name:"时令水果",icon:ee}];const t=Number(w.query.categoryId);if(t){const e=n.value.findIndex(c=>c.id===t);if(e!==-1){u.value=e,m(t);return}}n.value.length>0&&m(n.value[0].id)},m=async t=>{try{C.value=1,I.value=!1,r.value=[],await P(t)}catch(e){console.error("加载分类商品失败:",e),h("加载分类商品失败")}},P=async t=>{try{const e=await N.get("/products");if(e.data.code===200){const _=e.data.data.filter($=>$.category_id===t),g=(C.value-1)*V.value,b=g+V.value,k=_.slice(g,b);r.value=[...r.value,...k],r.value.length>=_.length&&(I.value=!0),C.value++}v.value=!1}catch(e){console.error("获取商品失败:",e),v.value=!1,h("获取商品失败")}},F=()=>{d.value?P(d.value.id):v.value=!1},M=async t=>{try{(await N.post("/cart/add",{productId:t.id,quantity:1})).data.code===200&&h("添加成功")}catch(e){console.error("添加购物车失败:",e),h("添加购物车失败")}};return z(()=>w.query.categoryId,t=>{if(t&&n.value.length>0){const e=Number(t),c=n.value.findIndex(_=>_.id===e);c!==-1&&(u.value=c,m(e))}}),D(()=>{L()}),(t,e)=>{const c=l("van-nav-bar"),_=l("van-sidebar-item"),g=l("van-sidebar"),b=l("van-empty"),k=l("van-icon"),$=l("van-cell"),S=l("van-list");return s(),f("div",ae,[x(c,{title:"分类",fixed:"",placeholder:""}),o("div",te,[o("div",ne,[x(g,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a)},{default:p(()=>[(s(!0),f(B,null,q(n.value,a=>(s(),y(_,{key:a.id,title:a.name,onClick:T=>m(a.id)},null,8,["title","onClick"]))),128))]),_:1},8,["modelValue"])]),o("div",oe,[d.value?(s(),f("div",se,[o("div",ce,[o("img",{src:d.value.icon,alt:d.value.name},null,8,ie)]),o("div",le,R(d.value.name),1)])):E("",!0),r.value.length===0?(s(),y(b,{key:1,description:"暂无商品"})):(s(),y(S,{key:2,loading:v.value,"onUpdate:loading":e[1]||(e[1]=a=>v.value=a),finished:I.value,"finished-text":"没有更多了",onLoad:F},{default:p(()=>[o("div",re,[(s(!0),f(B,null,q(r.value,a=>(s(),y($,{key:a.id,title:a.title,label:`¥${a.price}`,center:""},{icon:p(()=>[o("div",de,[o("img",{src:a.image,alt:a.title},null,8,_e)])]),"right-icon":p(()=>[x(k,{name:"cart-o",class:"cart-icon",onClick:G(T=>M(a),["stop"])},null,8,["onClick"])]),_:2},1032,["title","label"]))),128))])]),_:1},8,["loading","finished"]))])])])}}},fe=U(ue,[["__scopeId","data-v-073be7eb"]]);export{fe as default};
