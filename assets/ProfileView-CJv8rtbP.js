import{_ as K,r,v as Q,o as W,c as S,a as o,b as s,x as X,d as l,w as d,t as N,e as v,u as Y,f as I,n as b,y as Z,p as _,z as g}from"./index-BBH-rqu3.js";const $={class:"profile"},ee={key:0,class:"not-logged-in"},ae={class:"avatar-placeholder"},oe={class:"login-buttons"},se={key:1,class:"user-info"},te={class:"user-header"},ne={class:"user-details"},re={class:"user-functions"},le={__name:"ProfileView",setup(ie){const p=Y(),m=r(!1),t=Q({id:"",nickname:"",avatar:"",signature:""}),k=r(!1),i=r(""),f=r(""),w=r(!1),u=r(""),h=r([]),x=r(null),T=async()=>{try{const a=await v.get("/user/check-login");a.data.code===200&&(m.value=a.data.data.isLoggedIn,m.value&&O())}catch(a){console.error("获取登录状态失败",a)}},O=async()=>{try{const a=await v.get("/user/info");a.data.code===200&&Object.assign(t,a.data.data)}catch(a){console.error("获取用户信息失败",a);const e=localStorage.getItem("userInfo");e&&Object.assign(t,JSON.parse(e))}},R=()=>{p.push("/login")},U=()=>{p.push("/register")},L=async()=>{try{localStorage.removeItem("userInfo"),localStorage.removeItem("isLoggedIn"),Object.assign(t,{id:"",nickname:"",avatar:"",signature:""}),m.value=!1,_("已退出登录")}catch(a){console.error("退出登录失败",a),g("退出失败，请重试")}},j=()=>{i.value=t.nickname,f.value="",k.value=!0},B=async()=>{if(!i.value.trim())return f.value="昵称不能为空",!1;try{const a=await v.post("/user/check-nickname",{nickname:i.value});if(a.data.code!==200)return f.value=a.data.message,!1;if((await v.post("/user/update",{nickname:i.value})).data.code===200)return t.nickname=i.value,_("昵称修改成功"),!0}catch(a){return console.error("保存昵称失败",a),g("保存失败，请重试"),!1}},D=()=>{u.value=t.signature||"",w.value=!0},J=async()=>{try{if((await v.post("/user/update",{signature:u.value})).data.code===200){t.signature=u.value;const e=localStorage.getItem("userInfo");let c=e?JSON.parse(e):{};return c.signature=u.value,localStorage.setItem("userInfo",JSON.stringify(c)),_("个性签名修改成功"),!0}}catch(a){return console.error("保存个性签名失败",a),g("保存失败，请重试"),!1}},A=a=>["image/jpeg","image/png","image/gif"].includes(a.type)?a.size>2097152?(g("图片大小不能超过 2MB"),!1):!0:(g("请上传 jpg、png、gif 格式图片"),!1),E=async a=>{try{const e=await v.post("/user/upload-avatar");e.data.code===200&&(t.avatar=e.data.data.url,_("头像上传成功"),h.value=[])}catch(e){console.error("上传头像失败",e),g("上传失败，请重试")}},F=()=>{x.value.chooseFile()},M=()=>{p.push("/orders")},P=()=>{p.push("/address")};return W(()=>{T()}),(a,e)=>{const c=l("van-icon"),y=l("van-button"),q=l("van-image"),V=l("van-cell"),G=l("van-cell-group"),C=l("van-field"),z=l("van-dialog"),H=l("van-uploader");return I(),S("div",$,[e[10]||(e[10]=o("div",{class:"profile-header"},[o("h2",null,"我的")],-1)),m.value?(I(),S("div",se,[o("div",te,[o("div",{class:"avatar",onClick:F},[s(q,{round:"",width:"70px",height:"70px",src:t.avatar,"error-icon":"photo-o"},null,8,["src"]),e[8]||(e[8]=o("div",{class:"avatar-edit"},"编辑",-1))]),o("div",ne,[o("div",{class:"nickname",onClick:j},[o("span",null,N(t.nickname),1),s(c,{name:"edit",size:"14"})]),o("div",{class:"signature",onClick:D},[o("span",null,N(t.signature||"点击添加个性签名"),1),s(c,{name:"edit",size:"14"})])]),s(y,{class:"logout-btn",size:"small",onClick:L},{default:d(()=>e[9]||(e[9]=[b("退出登录")])),_:1,__:[9]})]),o("div",re,[s(G,{inset:""},{default:d(()=>[s(V,{title:"我的订单","is-link":"",onClick:M,icon:"orders-o"}),s(V,{title:"收货地址","is-link":"",onClick:P,icon:"location-o"})]),_:1})])])):(I(),S("div",ee,[o("div",ae,[s(c,{name:"manager-o",size:"50"})]),e[7]||(e[7]=o("div",{class:"login-info"},[o("p",null,"未登录"),o("p",{class:"login-tip"},"请先登录")],-1)),o("div",oe,[s(y,{type:"primary",size:"small",onClick:R},{default:d(()=>e[5]||(e[5]=[b("登录")])),_:1,__:[5]}),s(y,{plain:"",type:"primary",size:"small",onClick:U},{default:d(()=>e[6]||(e[6]=[b("注册")])),_:1,__:[6]})])])),s(z,{show:k.value,"onUpdate:show":e[1]||(e[1]=n=>k.value=n),title:"修改昵称","show-cancel-button":"",onConfirm:B},{default:d(()=>[s(C,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=n=>i.value=n),placeholder:"请输入昵称","error-message":f.value},null,8,["modelValue","error-message"])]),_:1},8,["show"]),s(z,{show:w.value,"onUpdate:show":e[3]||(e[3]=n=>w.value=n),title:"修改个性签名","show-cancel-button":"",onConfirm:J},{default:d(()=>[s(C,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=n=>u.value=n),type:"textarea",placeholder:"请输入个性签名",rows:"3",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["show"]),X(s(H,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=n=>h.value=n),"max-count":1,"before-read":A,"after-read":E,ref_key:"uploader",ref:x},null,8,["modelValue"]),[[Z,!1]])])}}},ue=K(le,[["__scopeId","data-v-bbbf0955"]]);export{ue as default};
