import{_ as j,r,i as z,j as D,o as E,c as g,b as V,a as l,d as i,w as p,k as q,h,t as R,e as I,l as A,s as f,f as s,F as L,g as $,m as G}from"./index-DUty09co.js";const H={class:"category"},J={class:"category-container"},K={class:"category-nav"},O={class:"category-content"},Q={key:0,class:"category-header"},W={class:"category-icon"},X=["src"],Y={class:"category-name"},Z={class:"product-list"},ee={class:"product-img"},te=["src","alt"],ae={__name:"CategoryView",setup(oe){const P=A(),o=r([]),d=r([]),v=r(0),_=r(!1),k=r(!1),C=r(1),N=r(10),u=z(()=>o.value.length===0?null:o.value[v.value]),F=async()=>{try{const t=await I.get("/categories");if(t.data.code===200){o.value=t.data.data;const e=Number(P.query.categoryId);if(e){const n=o.value.findIndex(c=>c.id===e);if(n!==-1){v.value=n,m(e);return}}o.value.length>0&&m(o.value[0].id)}}catch(t){console.error("获取分类失败:",t),f("获取分类失败")}},m=async t=>{try{C.value=1,k.value=!1,d.value=[],await B(t)}catch(e){console.error("加载分类商品失败:",e),f("加载分类商品失败")}},B=async t=>{try{const e=await I.get("/products");if(e.data.code===200){const c=e.data.data.filter(w=>w.category_id===t),y=(C.value-1)*N.value,b=y+N.value,x=c.slice(y,b);d.value=[...d.value,...x],d.value.length>=c.length&&(k.value=!0),C.value++}_.value=!1}catch(e){console.error("获取商品失败:",e),_.value=!1,f("获取商品失败")}},M=()=>{u.value?B(u.value.id):_.value=!1},S=async t=>{try{(await I.post("/cart/add",{productId:t.id,quantity:1})).data.code===200&&f("添加成功")}catch(e){console.error("添加购物车失败:",e),f("添加购物车失败")}};return D(()=>P.query.categoryId,t=>{if(t&&o.value.length>0){const e=Number(t),n=o.value.findIndex(c=>c.id===e);n!==-1&&(v.value=n,m(e))}}),E(()=>{F()}),(t,e)=>{const n=i("van-nav-bar"),c=i("van-sidebar-item"),y=i("van-sidebar"),b=i("van-empty"),x=i("van-icon"),w=i("van-cell"),T=i("van-list");return s(),g("div",H,[V(n,{title:"分类",fixed:"",placeholder:""}),l("div",J,[l("div",K,[V(y,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a)},{default:p(()=>[(s(!0),g(L,null,$(o.value,a=>(s(),h(c,{key:a.id,title:a.name,onClick:U=>m(a.id)},null,8,["title","onClick"]))),128))]),_:1},8,["modelValue"])]),l("div",O,[u.value?(s(),g("div",Q,[l("div",W,[u.value.icon?(s(),g("img",{key:0,src:u.value.icon,alt:"分类图标"},null,8,X)):q("",!0)]),l("div",Y,R(u.value.name),1)])):q("",!0),d.value.length===0?(s(),h(b,{key:1,description:"暂无商品"})):(s(),h(T,{key:2,loading:_.value,"onUpdate:loading":e[1]||(e[1]=a=>_.value=a),finished:k.value,"finished-text":"没有更多了",onLoad:M},{default:p(()=>[l("div",Z,[(s(!0),g(L,null,$(d.value,a=>(s(),h(w,{key:a.id,title:a.title,label:`¥${a.price}`,center:""},{icon:p(()=>[l("div",ee,[l("img",{src:a.image,alt:a.title},null,8,te)])]),"right-icon":p(()=>[V(x,{name:"cart-o",class:"cart-icon",onClick:G(U=>S(a),["stop"])},null,8,["onClick"])]),_:2},1032,["title","label"]))),128))])]),_:1},8,["loading","finished"]))])])])}}},ne=j(ae,[["__scopeId","data-v-fea1c7d8"]]);export{ne as default};
