import{_ as A,r as h,i as F,C as N,o as V,c as l,b as u,k as q,a as s,d as _,t as o,F as D,e as L,n as g,w as $,f as y,s as d,u as B,g as p,q as T}from"./index-DGB3ysgZ.js";import{u as J}from"./orders-D4REZOmA.js";const E={class:"confirm-order"},M={class:"address-info"},P={class:"user-info"},R={class:"name"},j={class:"phone"},z={class:"address-detail"},G={class:"address-divider"},H={class:"order-products"},K={class:"product-image"},Q=["src","alt"],U={class:"product-info"},W={class:"product-title"},X={class:"product-price-quantity"},Y={class:"product-price"},Z={class:"product-quantity"},ss={class:"order-amount"},ts={class:"amount-item"},es={class:"amount-item total"},os={class:"total-price"},as={class:"submit-bar"},rs={class:"price-info"},ns={class:"price"},ds={__name:"ConfirmOrderView",setup(cs){const i=B(),b=J(),r=h([]),a=h(null),f=async()=>{try{const e=localStorage.getItem("selectedAddress");if(e){a.value=JSON.parse(e),localStorage.removeItem("selectedAddress");return}const t=await y.get("/addresses");if(t.data.code===200){const c=t.data.data.find(m=>m.isDefault)||t.data.data[0];a.value=c}}catch(e){console.error("获取地址失败",e),d("获取地址失败")}},x=()=>{i.push("/address?mode=select")},w=async()=>{try{const e=localStorage.getItem("confirmOrderItems");if(e)r.value=JSON.parse(e);else{const t=await y.get("/cart");if(t.data.code===200&&(r.value=t.data.data.filter(c=>c.selected),r.value.length===0)){d("请先选择商品"),i.push("/cart");return}}}catch(e){console.error("获取订单商品失败",e),d("获取订单商品失败")}},C=e=>e?`${e.province} ${e.city} ${e.county} ${e.addressDetail}`:"",v=F(()=>r.value.reduce((e,t)=>e+t.product.price*t.quantity,0)),k=async()=>{if(r.value.length===0){d("请先选择商品");return}if(!a.value){d("请先添加收货地址");return}const e=T({message:"提交订单中...",forbidClick:!0});try{const t=await b.submitOrder({addressId:a.value.id,items:r.value});e.close(),t.success&&(localStorage.removeItem("confirmOrderItems"),i.push("/orders"))}catch(t){e.close(),console.error("提交订单失败",t),d("提交订单失败")}},I=()=>{i.back()};return N(()=>{f()}),V(()=>{f(),w()}),(e,t)=>{const c=_("van-nav-bar"),m=_("van-icon"),S=_("van-divider"),O=_("van-button");return p(),l("div",E,[u(c,{title:"确认订单","left-arrow":"",onClickLeft:I,fixed:"",placeholder:""}),a.value?(p(),l("div",{key:0,class:"address-card",onClick:x},[s("div",M,[s("div",P,[s("span",R,"姓名："+o(a.value.name),1),s("span",j,"电话："+o(a.value.phone),1),u(m,{name:"arrow",class:"arrow-icon"})]),s("div",z,o(C(a.value)),1)]),s("div",G,[u(S,{dashed:"",style:{color:"#1989fa",borderColor:"#1989fa",padding:"0 16px"}})])])):q("",!0),s("div",H,[(p(!0),l(D,null,L(r.value,n=>(p(),l("div",{class:"product-item",key:n.id},[s("div",K,[s("img",{src:n.product.image,alt:n.product.title},null,8,Q)]),s("div",U,[s("div",W,o(n.product.title),1),s("div",X,[s("div",Y,"¥"+o(n.product.price.toFixed(2)),1),s("div",Z,"x"+o(n.quantity),1)])])]))),128))]),s("div",ss,[s("div",ts,[t[0]||(t[0]=s("span",null,"商品金额",-1)),s("span",null,"¥"+o(v.value.toFixed(2)),1)]),t[2]||(t[2]=s("div",{class:"amount-item"},[s("span",null,"优惠"),s("span",null,"¥0.00")],-1)),s("div",es,[t[1]||(t[1]=s("span",null,"实付款",-1)),s("span",os,"¥"+o(v.value.toFixed(2)),1)])]),s("div",as,[s("div",rs,[t[3]||(t[3]=g(" 合计：")),s("span",ns,"¥"+o(v.value.toFixed(2)),1)]),u(O,{type:"danger",class:"submit-button",onClick:k},{default:$(()=>t[4]||(t[4]=[g("提交订单")])),_:1,__:[4]})])])}}},us=A(ds,[["__scopeId","data-v-152be02a"]]);export{us as default};
