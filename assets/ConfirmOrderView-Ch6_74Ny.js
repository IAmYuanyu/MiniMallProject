import{_ as A,r as g,i as O,C as F,o as N,c as l,b as u,k as V,a as s,d as _,t as o,F as q,g as D,n as y,w as L,e as f,s as c,u as T,f as p,q as $,p as B}from"./index-BBH-rqu3.js";const J={class:"confirm-order"},E={class:"address-info"},M={class:"user-info"},P={class:"name"},R={class:"phone"},j={class:"address-detail"},z={class:"address-divider"},G={class:"order-products"},H={class:"product-image"},K=["src","alt"],Q={class:"product-info"},U={class:"product-title"},W={class:"product-price-quantity"},X={class:"product-price"},Y={class:"product-quantity"},Z={class:"order-amount"},ss={class:"amount-item"},ts={class:"amount-item total"},es={class:"total-price"},os={class:"submit-bar"},as={class:"price-info"},rs={class:"price"},ns={__name:"ConfirmOrderView",setup(ds){const i=T(),r=g([]),a=g(null),h=async()=>{try{const e=localStorage.getItem("selectedAddress");if(e){a.value=JSON.parse(e),localStorage.removeItem("selectedAddress");return}const t=await f.get("/addresses");if(t.data.code===200){const n=t.data.data.find(m=>m.isDefault)||t.data.data[0];a.value=n}}catch(e){console.error("获取地址失败",e),c("获取地址失败")}},b=()=>{i.push("/address?mode=select")},w=async()=>{try{const e=localStorage.getItem("confirmOrderItems");if(e)r.value=JSON.parse(e);else{const t=await f.get("/cart");if(t.data.code===200&&(r.value=t.data.data.filter(n=>n.selected),r.value.length===0)){c("请先选择商品"),i.push("/cart");return}}}catch(e){console.error("获取订单商品失败",e),c("获取订单商品失败")}},x=e=>e?`${e.province} ${e.city} ${e.county} ${e.addressDetail}`:"",v=O(()=>r.value.reduce((e,t)=>e+t.product.price*t.quantity,0)),C=async()=>{if(r.value.length===0){c("请先选择商品");return}if(!a.value){c("请先添加收货地址");return}const e=$({message:"提交订单中...",forbidClick:!0});try{const t=await f.post("/order/submit",{addressId:a.value.id,items:r.value.map(n=>n)});t.data.code===200&&(e.close(),B("下单成功"),console.log(t),localStorage.removeItem("confirmOrderItems"),i.push("/orders"))}catch(t){e.close(),console.error("提交订单失败",t),c("提交订单失败")}},k=()=>{i.back()};return F(()=>{h()}),N(()=>{h(),w()}),(e,t)=>{const n=_("van-nav-bar"),m=_("van-icon"),I=_("van-divider"),S=_("van-button");return p(),l("div",J,[u(n,{title:"确认订单","left-arrow":"",onClickLeft:k,fixed:"",placeholder:""}),a.value?(p(),l("div",{key:0,class:"address-card",onClick:b},[s("div",E,[s("div",M,[s("span",P,"姓名："+o(a.value.name),1),s("span",R,"电话："+o(a.value.phone),1),u(m,{name:"arrow",class:"arrow-icon"})]),s("div",j,o(x(a.value)),1)]),s("div",z,[u(I,{dashed:"",style:{color:"#1989fa",borderColor:"#1989fa",padding:"0 16px"}})])])):V("",!0),s("div",G,[(p(!0),l(q,null,D(r.value,d=>(p(),l("div",{class:"product-item",key:d.id},[s("div",H,[s("img",{src:d.product.image,alt:d.product.title},null,8,K)]),s("div",Q,[s("div",U,o(d.product.title),1),s("div",W,[s("div",X,"¥"+o(d.product.price.toFixed(2)),1),s("div",Y,"x"+o(d.quantity),1)])])]))),128))]),s("div",Z,[s("div",ss,[t[0]||(t[0]=s("span",null,"商品金额",-1)),s("span",null,"¥"+o(v.value.toFixed(2)),1)]),t[2]||(t[2]=s("div",{class:"amount-item"},[s("span",null,"优惠"),s("span",null,"¥0.00")],-1)),s("div",ts,[t[1]||(t[1]=s("span",null,"实付款",-1)),s("span",es,"¥"+o(v.value.toFixed(2)),1)])]),s("div",os,[s("div",as,[t[3]||(t[3]=y(" 合计：")),s("span",rs,"¥"+o(v.value.toFixed(2)),1)]),u(S,{type:"danger",class:"submit-button",onClick:C},{default:L(()=>t[4]||(t[4]=[y("提交订单")])),_:1,__:[4]})])])}}},is=A(ns,[["__scopeId","data-v-f54817b8"]]);export{is as default};
