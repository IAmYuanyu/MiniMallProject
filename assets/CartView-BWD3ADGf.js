import{_ as z,r as O,i as y,o as A,c as g,b as d,a as o,d as i,h as b,F as E,g as L,w as v,n as x,t as h,e as u,s as n,u as D,f as _,p as w,q as J}from"./index-tK3xrCSp.js";const M={class:"cart"},P={class:"cart-container"},Q={key:1,class:"cart-list"},R={class:"cart-item"},$={class:"item-content"},j={class:"item-img"},G=["src","alt"],H={class:"item-info"},K={class:"item-title"},W={class:"item-price-stepper"},X={class:"item-price"},Y={class:"cart-footer"},Z={class:"select-all"},ee={class:"total-info"},te={class:"total-price"},se={class:"price"},oe={__name:"CartView",setup(ae){const C=D(),a=O([]),m=async()=>{try{const e=await u.get("/cart");e.data.code===200&&(a.value=e.data.data)}catch(e){console.error("获取购物车失败",e),n("获取购物车失败")}},V=async(e,t)=>{if(!(t<1))try{(await u.post("/cart/update",{id:e,quantity:t})).data.code}catch(s){console.error("更新数量失败",s),n("更新数量失败"),m()}},I=async(e,t)=>{try{if((await u.post("/cart/select",{id:e,selected:t})).data.code===200){const r=a.value.find(p=>p.id===e);r&&(r.selected=t)}}catch(s){console.error("更新选中状态失败",s),n("更新选中状态失败")}},S=async e=>{try{(await u.post("/cart/select",{id:"all",selected:e})).data.code===200&&a.value.forEach(s=>s.selected=e)}catch(t){console.error("全选操作失败",t),n("全选操作失败")}},U=async e=>{try{if((await u.post("/cart/remove",{id:e})).data.code===200){const s=a.value.findIndex(r=>r.id===e);s!==-1&&(a.value.splice(s,1),w("删除成功"))}}catch(t){console.error("删除商品失败",t),n("删除商品失败")}},q=async()=>{if(f.value===0){n("请先选择商品");return}const e=a.value.filter(s=>s.selected);localStorage.setItem("confirmOrderItems",JSON.stringify(e)),C.push("/confirmOrder");const t=J({message:"结算中...",forbidClick:!0});try{(await u.post("/cart/checkout")).data.code===200&&(t.close(),w("结算成功"),m())}catch(s){t.close(),console.error("结算失败",s),n("结算失败")}},B=y(()=>a.value.length>0&&a.value.every(e=>e.selected)),f=y(()=>a.value.filter(e=>e.selected).length),F=y(()=>a.value.filter(e=>e.selected).reduce((e,t)=>e+t.product.price*t.quantity,0));return A(()=>{m()}),(e,t)=>{const s=i("van-nav-bar"),r=i("van-empty"),p=i("van-checkbox"),N=i("van-stepper"),k=i("van-button"),T=i("van-swipe-cell");return _(),g("div",M,[d(s,{title:"购物车",fixed:"",placeholder:""}),o("div",P,[a.value.length===0?(_(),b(r,{key:0,description:"购物车还是空的"})):(_(),g("div",Q,[(_(!0),g(E,null,L(a.value,c=>(_(),b(T,{key:c.id},{right:v(()=>[d(k,{square:"",text:"删除",type:"danger",class:"delete-button",onClick:l=>U(c.id)},null,8,["onClick"])]),default:v(()=>[o("div",R,[d(p,{"model-value":c.selected,"onUpdate:modelValue":l=>I(c.id,l),"icon-size":"20px",class:"item-checkbox"},null,8,["model-value","onUpdate:modelValue"]),o("div",$,[o("div",j,[o("img",{src:c.product.image,alt:c.product.title},null,8,G)]),o("div",H,[o("div",K,h(c.product.title),1),o("div",W,[o("div",X,"¥"+h(c.product.price.toFixed(2)),1),d(N,{modelValue:c.quantity,"onUpdate:modelValue":l=>c.quantity=l,theme:"round","button-size":"22","disable-input":"",onChange:l=>V(c.id,l)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])])])]),_:2},1024))),128))]))]),o("div",Y,[o("div",Z,[d(p,{"model-value":B.value,"onUpdate:modelValue":S,"icon-size":"20px"},{default:v(()=>t[0]||(t[0]=[x("全选")])),_:1,__:[0]},8,["model-value"])]),o("div",ee,[o("div",te,[t[1]||(t[1]=x(" 合计: ")),o("span",se,"¥"+h(F.value.toFixed(2)),1)]),d(k,{type:"danger",class:"checkout-button",disabled:f.value===0,onClick:q},{default:v(()=>[x(" 结算 ("+h(f.value)+") ",1)]),_:1},8,["disabled"])])])])}}},ne=z(oe,[["__scopeId","data-v-18a86df8"]]);export{ne as default};
